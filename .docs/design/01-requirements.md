# 감성 이커머스 요구사항 정리서

## 1. 상품 목록 조회
- 사용자는 로그인 여부와 상관없이 상품 목록을 조회할 수 있어야한다.
- 사용자는 브랜드 
  - 상품
  - 정렬
  - 페이지
  - 페이지당 상품 수 등 조건을 설정하여 필터링 할 수 있어야한다.
- 조회된 상품 리스트는 
  - 브랜드 이름
  - 상품의 이름
  - 가격
  - 판매상태
  - 좋아요 갯수 등의 정보를 포함하여 보여줘야한다.
- 페이지네이션을 지원하며, 기본 상품 갯수는 20개로 한다.

### 기능적 요구사항
- Happy Path
   - 조회 조건이 없을 경우 
     - 전체 상품을 최신순으로 1페이지에서 20개 노출
   - 조회 조건이 있을 경우 
     - 조건에 맞는 상품을 최신순으로 노출하며 조건들에 대한 유효성 검사를 한다.
- Constraints
  - 페이지 번호는 1 이상이어야 한다.
- Fail Cases
  - 존재하지 않는 브랜드의 상품일 경우 "오류를 반환한다."
  - 브랜드는 존재하지만, 상품은 존재하지 않는 경우 "오류를 반환한다."

### 비기능적 요구사항
- 사용자 인증이 필요없는 공개 API로 정보를 제공한다.
- 최대 1초 이내 응답해야한다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환해야한다.
- 페이지 번호는 전체 상품 개수에 따라 유연하게 계산되어야 한다.

  | 케이스           | 설명                                 | HTTP 상태 코드    |에러메세지 |
  |---------------|------------------------------------|---------------|--------|
  | 브랜드 미존재       | 존재하지 않는 브랜드를 요청한 경우                | 404 Not Found | 존재하지 않는 브랜드입니다.
  | 상품 미존재        | 상품이 없는 경우                          | 404 Not Found | 존재하지 않는 상품입니다.|
  | 상품 목록 조회 중 예외 | 네트워크 느림, DB연결 실패, Transaction 실패 등 |   500 Internal Server Error  | 서버 오류가 발생했습니다. |
  
## 2. 상품 상세 조회
- 사용자는 로그인 여부와 상관없이 상품 상세 정보를 조회할 수 있어야한다.
- 조회된 상품에는
  - 브랜드(파트너)
  - 가격
  - 상품 상태
  - 쿠폰
  - 좋아요 
  - 좋아요 갯수 등이 표시되어있어야 한다.
- 판매 `종료`/`완료` 된 상품은 종료 안내 정보를 표시해야 된다.

### 기능적 요구사항
- Happy Path
  - 사용자가 선택한 상품의 상세 정보가 조회되어야 한다.
- Constraints
  - 상품 ID는 필수로 파라미터에 담겨와야한다.
- Fail Cases
  - 상품ID가 유효하지 않을 경우 "오류를 반환한다."
  - 브랜드 정보가 없을경우 "오류를 반환한다."

### 비기능적 요구사항
- 사용자 인증이 필요 없는 공개 API로 정보를 제공한다.
- 최대 1초 이내 응답해야한다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환해야한다.

| 케이스                  | 설명                          | HTTP 오류코드 | 에러메세지             |
|----------------------|-----------------------------|--------------|-------------------|
 | 상품 ID가 유효하지 않은 형식    | 상품ID가 null 또는 없는 상품 ID인 경우 | 404 Not Found  | 해당 상품을 찾을 수 없습니다. |
| 연결된 브랜드 ID가 없을 경우 | 상품은 있으나 참조된 ID의 데이터들이 삭제된 경우 |500 Internal Server Error | 상품 정보가 불안전합니다. 	  |
| 상품 상세 조회 중 예외        | 네트워크 느림, DB연결 실패, Transaction 실패 등 |   500 Internal Server Error  | 서버 오류가 발생했습니다. |
| 좋아요 여부 못 가져왔을 경우 | 비즈니스 로직 오류 | 400 BAD REQUEST | 상품 정보가 불안전합니다.|

## 3. 브랜드 조회
- 사용자는 로그인 여부와 상관없이 브랜드 조회를 할 수 있어야한다.
- 페이지네이션을 지원하며, 기본 상품 갯수는 20개로 한다.

### 기능적 요구사항
- Happy Path
  - 사용자가 선택한 브랜드의 상품이 조회된다.

- Constraints
  - 상품들에는 브랜드ID가 필수로 담겨져있어야 한다.
  - 페이지 번호는 1 이상이어야 한다.

- Fail Cases 
  - 브랜드가 존재하지 않을 경우 "오류를 반환한다."
  - 브랜드의 상품이 존재하지 않는 경우 "오류를 반환한다."

### 비기능적 요구사항
- 사용자 인증이 필요 없는 공개 API로 정보를 제공한다.
- 최대 1초 이내 응답해야한다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환해야한다.
- 페이지 번호는 전체 상품 개수에 따라 유연하게 계산되어야 한다.

| 케이스 | 설명 | HTTP 상태코드 | 에러메세지              |
|-------|-----|-------------|--------------------|
 | 브랜드 미존재 | 존재하지 않는 브랜드를 요청한 경우 | 404 Not Found | 존재하지 않는 브랜드입니다.    |
 | 상품 미존재 | 상품이 없는 경우 | 404 Not Found | 상품이 존재하지 않습니다. |
 | 브랜드 조회 중 예외 | 네트워크 느림, 비즈니스로직 실패, DB연결 실패 |   500 Internal Server Error  | 서버 오류가 발생했습니다. |




## 4. 상품 좋아요 등록 / 취소
- 로그인 한 사용자만 좋아요를 누를 수 있어야한다.
- 좋아요를 누른 상태에서 재클릭시 취소가 되어야한다.

### 기능적 요구사항
- Happy Path
  - 좋아요/ 취소가 바로 보여야 한다.
 - 동일한 요청을 여러 번 보내도 상태는 안정적으로 유지된다.

- Constraints
  - 상품 ID와 사용자 ID는 필수로 담겨져야 된다.
  - 사용자는 반드시 로그인 된 상태여야 하며, X-USER-ID 헤더를 통해 인증된다.
  
- Fail Cases
  - 로그인하지 않은 사용자에게는 "오류를 반환한다."
  - 상품이 존재하지 않는 경우 "오류를 반환한다."

### 비기능적 요구사항
- 사용자 인증은 X-USER_ID Header 기반으로 처리된다.
- 클라이언트에서 좋아요 존재여부 확인 후 api를 요청해야 한다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환해야 한다.

|케이스 | 설명 | HTTP 상태코드 | 에러메세지           |
|-----|-----|--------------|-----------------|
| 비로그인 사용자 요청 | 인증 헤더 없음/ 해당 유저가 존재하지 않는다. | 401 UNAUTHORIZED | 사용자가 확인되지 않습니다. |
| 존재하지 않는 상품 | 상품 ID가 없거나 null 일 경우 | 404 NOT FOUND | 존재하지 않는 상품입니다. |
| 내부 서버 오류 | 네트워크 느림, 비즈니스로직 실패, DB연결 실패 |   500 Internal Server Error  | 서버 오류가 발생했습니다. |

## 5. 내가 찜한 상품 보기
- 로그인 한 사용자만 찜한 상품을 볼 수 있어야한다.
- 사용자가 좋아요한 상품들만 보여야 한다.
- 페이지네이션을 지원하며, 기본 상품 갯수는 20개로 한다.

### 기능적 요구사항 
- Happy Path
  - 좋아요를 누른 상품들이 보여야 한다.

- Constraints
  - 사용자ID 와 상품 ID는 필수로 담겨져야 한다.
  - 찜한 상품들은 좋아요가 true인 상품들만 조회되어야 한다.
  - 페이지 번호는 1 이상이어야 한다.

- Fail Cases
  - 로그인 하지 않은 사용자에게는 "오류를 반환한다".
  - 상품이 없는 경우 "오류를 반환한다."

### 비기능적 요구사항
- 사용자 인증은 X-USER_ID Header 기반으로 처리된다.
- API 응답은 1초 이내에 완료되어야 한다.
- 비정상 요청에 대해서는 적절한 HTTP 상태 코드와 에러 메시지를 반환해야 한다.
- 사용자가 찜한 상품 수가 많을 경우를 대비해 페이징 처리가 적용되어야 한다.

  |케이스 | 설명 | HTTP 상태코드 | 에러메세지           |
  |-----|-----|--------------|-----------------|
  | 비로그인 사용자 요청 | 인증 헤더 없음/ 해당 유저가 존재하지 않는다. | 401 UNAUTHORIZED | 사용자가 확인되지 않습니다. |
  | 존재하지 않는 상품 | 상품 ID가 없거나 null 일 경우 | 404 NOT FOUND | 존재하지 않는 상품입니다. |
  | 찜한 상품이 없음  | 상품은 존재하나, 찜한 상품이 없는 경우 | 404 NOT FOUND | 찜한 상품이 없습니다. |
  | 내부 서버 오류 | 네트워크 느림, 비즈니스로직 실패, DB연결 실패 |   500 Internal Server Error  | 서버 오류가 발생했습니다. |
  
## 6. 장바구니 등록
- 로그인 한 사용자는 원하는 상품을 장바구니에 추가한다.
- 동일한 상품이 존재하는 경우 수량증가, 존재하지 않는다면 항목 추가한다.

### 기능적 요구사항
- Happy Path
  - 사용자는 원하는 상품을 원하는 수량만큼 장바구니에 추가할 수 있어야한다.
  - 동일한 상품이 이미 있다면, 수량을 증가시킨다.

- Constraints
  - 사용자 ID와 상품 ID는 반드시 필수로 담겨져서 와야한다.

- Fail cases
  - 비 로그인 사용자는 "오류를 반환한다."
  - 상품이 존재하지 않는다면 "오류를 반환한다."
  - 상품의 상태가 "판매중"이 아닐 경우 "오류를 반환한다."

- ### 비기능적 요구사항
- 사용자 인증은 X-USER_ID Header 기반으로 처리된다.
- 장바구니 등록 요청은 1초 이내에 처리되어야 한다.
- 중복된 상품 등록은 허용되지 않으며, 수량 증가 방식으로만 처리되어야한다
- 비정상 요청에 대해서는 적절한 HTTP 상태 코드와 에러 메시지를 반환해야 한다.

|케이스 | 설명                          | HTTP 상태코드 | 에러메세지|
|------|-----------------------------|-------------|---------|
| 비로그인 사용자 요청 | 인증 헤더 없음/ 해당 유저가 존재하지 않는다.  | 401 UNAUTHORIZED | 사용자가 확인되지 않습니다. |
| 존재하지 않는 상품 | 상품 ID가 없거나 null 일 경우        | 404 NOT FOUND | 존재하지 않는 상품입니다. |
|판매중이 아닌 상품 | 품절, 판매종료, 재고부족인 상품일 경우      | 400 BAD REQUEST	 | 현재 판매중인 상품이 아닙니다. | 
| 내부 서버 오류 | 네트워크 느림, 비즈니스로직 실패, DB연결 실패 |   500 Internal Server Error  | 서버 오류가 발생했습니다. |

[//]: # (## 주문 생성 및 결제흐름)
## 7. 주문 생성 및 결제 흐름
- 로그인된 사용자는 상품을 선택하여  결제할 수 있어야 한다.
- 사용자는 상품을 결제할 때 포인트 결제가 가능해야한다.
- 결제가 완료되면 주문이 생성되고, 관련 상품의 재고가 차감되어야 한다.
- 주문은 한 번만 생성되도록 멱등하게 설계되어야 한다.

### 기능적 요구사항
- Happy Path
  - 사용자가 결제 요청 시, PG사 결제 창이 정상적으로 노출되고 결제가 성공되어야 한다.
  - 주문 생성 시 포인트 금액, 총 결제금액, 사용포인트, 상품 정보등이 저장되어야 한다.

- Constraints
  - 주문 전체 금액은 포인트 금액과 상품 결제 금액과 같아야한다.

- Fail Cases
  - 포인트 결제 실패 시 "오류를 반환한다."
  - 재고가 부족한 경우, 주문/결제가 중단되고 "오류를 반환한다."
  - 동일한 결제 요청이 중복 수신 된 경우 "오류를 반환한다."

### 비기능적 요구사항
- 주문은 정확히 한 번만 처리해야하며, 재시도 요청에도 중복 생성되지 않아야 된다.
- 주문, 결제는 1초 이내로 응답해야 한다.
- 비정상 요청에 대해서는 적절한 HTTP 상태 코드와 에러 메시지를 반환해야 한다.

| 케이스         | 설명                          | HTTP 상태코드        | 에러메세지          |
|-------------|-----------------------------|------------------|----------------|
| 비로그인 사용자 요청 | 인증 헤더 없음/ 해당 유저가 존재하지 않는다.  | 401 UNAUTHORIZED | 사용자가 확인되지 않습니다. |
| 재고가 없는 상품 | 재고가 없는 상품일 경우               | 409 Conflict     | 재고가 부족합니다.     |
 |결제 실패 | 포인트 부족등으로  결제 실패일 경우        | 402 Payment Required | 결제가 실패되었습니다.   |
| 내부 서버 오류 | 네트워크 느림, 비즈니스로직 실패, DB연결 실패 |   500 Internal Server Error  | 서버 오류가 발생했습니다. |

## 8. 유저의 주문 목록 조회
- 로그인 된 사용자는 본인이 결제한 주문 목록을 조회할 수 있어야 한다.

### 기능적 요구사항
- Happy Path
  - 사용자가 로그인한 상태로 주문 목록 조회를 호출하면, 자신이 결제한 주문 목록이 정상적으로 조회되어야한다.
  - 조회목록에는 
    - 주문ID
    - 결제일시
    - 총 결제 금액
    - 주문 상태 
    - 상품 목록등이 포함되어야 한다.

- Constraints
  - 주문 목록은 로그인 된 유저 본인의 데이터만 조회할 수 있어야 한다.
  - 사용자ID 는 필수로 담겨져서 와야한다.

- Fail Cases
  - 비 로그인 사용자에게는 "오류를 반환한다."
  - 사용자의 주문/결제 내역이 없는 경우 "오류를 반환한다."
  
### 비기능적 요구사항
- 사용자 인증은 X-USER_ID Header 기반으로 처리된다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환해야 한다.

| 케이스         | 설명 | HTTP 상태코드 | 에러메세지|
|-------------|------|-------------|----------|
| 비로그인 사용자 요청 | 인증 헤더 없음/ 해당 유저가 존재하지 않는다. | 401 UNAUTHORIZED | 사용자가 확인되지 않습니다. |
| 주문 데이터 없음   | 결제/주문 내역이 없는 경우 | 204 No Content | 주문 내역이 존재하지 않습니다.|
| 내부 서버 오류 | 네트워크 느림, 비즈니스로직 실패, DB연결 실패 |   500 Internal Server Error  | 서버 오류가 발생했습니다. |


## 9. 단일 주문 목록 상세 조회
- 로그인 된 사용자는 본인이 결제한 특정 주문의 상세 정보를 조회할 수 있어야한다.

### 기능적 요구사항
- Happy Path
  - 사용자가 로그인한 상태로 특정 주문에 대한 상세 조회를하면 주문 상세 정보가 보여야한다.

- Constraints
  - 주문은 반드시 로그인된 사용자 본인의 주문이어야만 조회할 수 있다.
  - 결제가 완료된 주문만 상세 조회 대상이 된다.
  - 사용자 ID, 주문ID는 필수로 담겨져서 와야한다.

- Fail Cases
  - 비 로그인 사용자에게는 "오류를 반환한다."
  - 사용자의 주문/결제 내역이 없는 경우 "오류를 반환한다."
  - 본인의 주문이 아닌 경우  "오류를 반환한다."

### 비기능적 요구사항
- 사용자 인증은 X-USER_ID Header 기반으로 처리된다.
- 주문ID는 PathVariable로 전달 받는다.
- 주문 상세 정보 응답은 1초 이내로 반환되어야 한다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환해야 한다.

|케이스 | 설명 | HTTP 상태코드                 | 에러메시지|
|-----|------|---------------------------|-----------|
| 비로그인 사용자 요청 | 인증 헤더 없음/ 해당 유저가 존재하지 않는다. | 401 UNAUTHORIZED          | 사용자가 확인되지 않습니다. |
| 주문 데이터 없음   | 결제/주문 내역이 없는 경우 | 404 No Content            | 주문 내역이 존재하지 않습니다.|
|본인 주문 아님 | 다른 사용자의 주문을 조회하려는 경우 | 403 Forbidden | 접근 권한이 없습니다. |                       
| 내부 서버 오류 | 네트워크 느림, 비즈니스로직 실패, DB연결 실패 | 500 Internal Server Error | 서버 오류가 발생했습니다. |
